# Tab 独立设置功能说明

## 功能概述

为了提升用户体验和工作效率，现在每个 Tab 都可以独立记住自己的排序方式和视图模式。不同的 Tab 可以有不同的显示偏好，系统会自动保存并在切换时恢复。

## 主要特性

### 1. 独立排序设置

每个 Tab 可以设置不同的排序方式：

- **待办** tab：可以使用"手动排序"，方便您自定义优先级
- **进行中** tab：可以使用"创建时间降序"，最新的任务显示在前
- **已完成** tab：可以使用"完成时间降序"，最近完成的显示在前
- **自定义标签** tab：根据需要选择任何排序方式

### 2. 独立视图模式

每个 Tab 可以设置不同的视图模式：

- **待办** tab：使用"卡片视图"，查看完整信息
- **进行中** tab：使用"专注视图"，专注于内容编辑
- **其他** tab：根据工作场景灵活选择

### 3. 自动保存和恢复

- ✅ 切换 Tab 时自动恢复该 Tab 的设置
- ✅ 修改排序或视图后自动保存
- ✅ 重启应用后所有设置都被保留
- ✅ 新建自定义 Tab 使用默认设置（创建时间降序 + 卡片视图）

## 使用场景

### 场景 1：任务管理工作流

```
📋 待办 Tab
├─ 排序：手动排序
├─ 视图：卡片视图
└─ 原因：需要手动调整任务优先级，查看所有元数据

🚀 进行中 Tab
├─ 排序：创建时间降序
├─ 视图：专注视图
└─ 原因：专注于当前工作，编辑任务详细内容

✅ 已完成 Tab
├─ 排序：更新时间降序（完成时间）
├─ 视图：卡片视图
└─ 原因：查看最近完成的任务，回顾工作进度
```

### 场景 2：项目分类管理

```
🏷️ 项目A Tab (自定义标签)
├─ 排序：手动排序
├─ 视图：卡片视图
└─ 原因：按项目计划顺序安排任务

🏷️ 项目B Tab (自定义标签)
├─ 排序：截止时间升序
├─ 视图：专注视图
└─ 原因：紧急项目，按截止时间排序，专注内容
```

## 技术实现

### 数据结构

```typescript
// 每个 Tab 的配置
interface TabSettings {
  sortOption: SortOption;  // 排序方式
  viewMode: ViewMode;      // 视图模式
}

// 所有 Tab 的配置映射
type TabSettingsMap = {
  [tabKey: string]: TabSettings;
}
```

### 默认值

- **排序方式**：`'createdAt-desc'`（创建时间降序）
- **视图模式**：`'card'`（卡片视图）

### 持久化

设置保存在数据库的 `settings` 表中，格式为 JSON 字符串：

```json
{
  "tabSettings": "{
    \"all\": {
      \"sortOption\": \"createdAt-desc\",
      \"viewMode\": \"card\"
    },
    \"pending\": {
      \"sortOption\": \"manual\",
      \"viewMode\": \"card\"
    },
    \"in_progress\": {
      \"sortOption\": \"createdAt-desc\",
      \"viewMode\": \"content-focus\"
    }
  }"
}
```

### 向后兼容

- 升级后首次运行时，会自动迁移旧的全局设置到"全部" Tab
- 其他 Tab 使用默认设置
- 用户无需手动配置，即可无缝升级

## 使用说明

### 1. 设置排序方式

1. 切换到想要配置的 Tab（如"待办"）
2. 在工具栏的排序下拉菜单中选择排序方式
3. 设置自动保存

### 2. 设置视图模式

1. 切换到想要配置的 Tab
2. 在工具栏的视图切换按钮中选择视图模式（卡片/专注）
3. 设置自动保存

### 3. 切换 Tab

- 切换到其他 Tab 时，会自动恢复该 Tab 的设置
- 无需手动切换，系统会记住每个 Tab 的偏好

### 4. 重置设置（可选）

如果需要重置某个 Tab 的设置：
1. 切换到该 Tab
2. 选择想要的排序方式和视图模式
3. 系统会自动覆盖保存

## 实现细节

### 核心函数

1. **getCurrentTabSettings()**
   - 获取当前活动 Tab 的设置
   - 如果没有设置，返回默认值

2. **updateCurrentTabSettings()**
   - 更新当前 Tab 的设置
   - 自动保存到数据库

3. **saveTabSettings()**
   - 将设置序列化为 JSON
   - 保存到数据库

### 性能优化

- 使用 `useCallback` 缓存函数，避免不必要的重渲染
- 使用 `useMemo` 缓存当前 Tab 设置
- 仅在设置真正改变时才保存到数据库

### 调试功能

控制台会输出 Tab 切换信息，方便开发调试：

```
[Tab切换] pending: {sortOption: 'manual', viewMode: 'card'}
[Tab切换] in_progress: {sortOption: 'createdAt-desc', viewMode: 'content-focus'}
```

## 修改文件

- ✅ `src/renderer/App.tsx` - 核心逻辑实现

## 测试建议

1. **基本功能测试**
   - ✅ 在"待办" Tab 设置手动排序 + 卡片视图
   - ✅ 切换到"进行中" Tab，设置创建时间降序 + 专注视图
   - ✅ 切换回"待办" Tab，验证设置是否保留

2. **持久化测试**
   - ✅ 配置多个 Tab 的不同设置
   - ✅ 重启应用
   - ✅ 验证所有 Tab 的设置都被正确恢复

3. **新 Tab 测试**
   - ✅ 创建新的自定义标签 Tab
   - ✅ 验证使用默认设置（创建时间降序 + 卡片视图）

4. **升级测试**
   - ✅ 从旧版本升级
   - ✅ 验证旧设置被正确迁移到"全部" Tab

## 优势

### 提升效率
- 不同场景使用不同配置，无需频繁切换设置
- 系统自动记忆，减少重复操作

### 灵活性
- 每个 Tab 完全独立，互不干扰
- 适应不同的工作流程和习惯

### 用户体验
- 自动保存，无需手动确认
- 重启后保留，设置不丢失
- 向后兼容，升级无痛

## 未来改进

- [ ] 添加"复制设置"功能，快速应用到其他 Tab
- [ ] 添加"重置为默认"按钮，快速恢复默认设置
- [ ] 支持导出/导入 Tab 配置

---

📅 **实现日期**: 2025-10-30  
👤 **需求提出**: 用户反馈希望每个 Tab 独立记忆排序和视图设置  
✅ **状态**: 已完成并可用  
🎯 **影响范围**: 全部 Tab（包括自定义标签 Tab）

