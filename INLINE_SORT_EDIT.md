# 内联序号编辑功能说明

## 功能概述

在待办列表页面直接显示并编辑显示序号，无需进入编辑表单，实现快速调整待办顺序。

## 新增功能

### 1. 列表内联编辑
- **显示位置**：待办卡片左侧
- **显示条件**：仅在选择"手动排序"模式时显示
- **输入框宽度**：70px，足够显示3位数
- **提示信息**：鼠标悬停显示"输入序号后按回车或点击其他地方保存"

### 2. 自动保存机制
- **触发方式**：
  - 按回车键保存
  - 点击其他地方（失去焦点）保存
- **保存反馈**：
  - 成功：显示"排序已更新"提示
  - 失败：显示"更新排序失败"提示并恢复原值
- **防重复保存**：如果值未改变，不触发保存

### 3. 用户体验优化
- **保存状态**：保存时输入框禁用，防止重复操作
- **实时反馈**：保存成功后列表立即重新排序
- **空值处理**：可以清空序号（设为null），该待办会移到无序号组
- **多待办编辑**：支持同时编辑多个待办的序号

## 使用方法

### 快速调整顺序
1. 在工具栏选择"手动排序"
2. 每个待办卡片左侧会显示序号输入框
3. 点击输入框，输入新的序号
4. 按回车或点击其他地方自动保存
5. 列表立即按新顺序重新排列

### 示例场景

**场景1：将待办置顶**
```
原顺序：
[10] 待办A
[20] 待办B
[30] 待办C

操作：将待办C的序号改为5
结果：
[5] 待办C
[10] 待办A
[20] 待办B
```

**场景2：批量调整**
```
可以连续修改多个待办的序号：
1. 将待办A改为100
2. 将待办B改为200
3. 将待办C改为50
每次修改都会立即保存并重新排序
```

**场景3：移除序号**
```
清空待办的序号输入框，该待办会移到列表末尾（无序号组）
```

## 技术实现

### 组件更新

#### TodoList.tsx
- 添加 `sortOption` prop 判断是否显示序号输入框
- 添加 `onUpdateDisplayOrder` prop 处理序号更新
- 添加本地状态 `editingOrder` 跟踪正在编辑的序号
- 添加本地状态 `savingOrder` 跟踪正在保存的待办
- 实现 `handleOrderChange` 处理输入变化
- 实现 `handleOrderSave` 处理保存逻辑

#### App.tsx
- 添加 `handleUpdateDisplayOrder` 函数
- 调用 API 更新数据库
- 重新加载待办列表
- 传递 `sortOption` 和 `onUpdateDisplayOrder` 到 TodoList

### 布局结构
```tsx
<List.Item>
  <div style={{ display: 'flex', gap: 8 }}>
    {/* 序号输入框（仅手动排序模式） */}
    {sortOption === 'manual' && (
      <InputNumber
        value={displayOrder}
        onChange={handleOrderChange}
        onBlur={handleOrderSave}
        onPressEnter={blur}
      />
    )}
    
    {/* 原有待办卡片 */}
    <Card>...</Card>
  </div>
</List.Item>
```

### 保存流程
```
1. 用户输入新序号 → 更新 editingOrder 状态
2. 用户按回车/失去焦点 → 触发 handleOrderSave
3. 检查值是否改变 → 未改变则跳过
4. 添加到 savingOrder → 禁用输入框
5. 调用 onUpdateDisplayOrder → 更新数据库
6. 成功：清除 editingOrder，显示成功提示
7. 失败：恢复原值，显示错误提示
8. 移除 savingOrder → 启用输入框
9. 重新加载列表 → 显示新顺序
```

## 与表单编辑的对比

| 特性 | 内联编辑 | 表单编辑 |
|------|---------|---------|
| 速度 | ⚡ 快速 | 较慢 |
| 步骤 | 2步（输入+保存） | 4步（点击编辑+输入+保存+关闭） |
| 适用场景 | 快速调整顺序 | 修改完整信息 |
| 显示条件 | 仅手动排序模式 | 始终可用 |
| 批量操作 | ✅ 支持 | ❌ 不支持 |

## 优势

1. **效率提升**：无需打开编辑表单，直接在列表中修改
2. **直观反馈**：修改后立即看到排序效果
3. **批量调整**：可以连续修改多个待办的序号
4. **上下文保持**：不离开列表页面，保持工作流畅
5. **智能显示**：仅在需要时（手动排序模式）显示，不影响其他模式

## 注意事项

1. **网络延迟**：保存时输入框会禁用，等待保存完成
2. **序号冲突**：多个待办可以有相同序号，按创建时间次级排序
3. **空值处理**：清空序号会将待办移到无序号组
4. **模式切换**：切换到其他排序模式时，序号输入框会隐藏

## 测试清单

- [x] 手动排序模式下序号输入框正确显示
- [x] 其他排序模式下序号输入框不显示
- [x] 输入数字后按回车保存成功
- [x] 输入数字后点击其他地方保存成功
- [x] 清空序号（设为空）保存成功
- [x] 保存后列表立即重新排序
- [x] 保存失败时显示错误提示
- [x] 保存时输入框禁用
- [x] 值未改变时不触发保存
- [x] 在不同标签页下功能正常

## 更新文件

1. `src/renderer/components/TodoList.tsx` - 添加内联编辑UI和逻辑
2. `src/renderer/App.tsx` - 添加更新处理函数并传递props
3. `INLINE_SORT_EDIT.md` - 功能说明文档（本文件）

## 总结

内联序号编辑功能大大提升了手动排序的效率，用户可以快速、直观地调整待办顺序，无需频繁打开关闭编辑表单。结合之前实现的手动排序功能，为用户提供了完整、高效的待办列表管理体验。

