/* 流程图暗黑模式样式 */

/* React Flow 画布背景 */
[data-theme='dark'] .react-flow__pane {
  background-color: #0a0a0a !important;
}

/* React Flow 背景网格 */
[data-theme='dark'] .react-flow__background {
  background-color: #0a0a0a;
}

[data-theme='dark'] .react-flow__background-pattern {
  stroke: #2a2a2a;
}

/* 节点样式 */
[data-theme='dark'] .react-flow__node {
  color: #ffffff;
}

[data-theme='dark'] .react-flow__node-rectangle,
[data-theme='dark'] .react-flow__node-diamond,
[data-theme='dark'] .react-flow__node-circle,
[data-theme='dark'] .react-flow__node-todo {
  background-color: #141414;
  border-color: #404040;
  color: #ffffff;
}

/* 修复 Ant Design Typography 在暗黑模式下的显示 */
[data-theme='dark'] .ant-typography {
  color: #e8e8e8 !important;
}

[data-theme='dark'] .ant-space-item {
  color: #e8e8e8 !important;
}

/* 修复 Ant Design 其他文字组件 */
[data-theme='dark'] .ant-typography-secondary {
  color: #a8a8a8 !important;
}

[data-theme='dark'] .ant-descriptions-item-label,
[data-theme='dark'] .ant-descriptions-item-content {
  color: #e8e8e8 !important;
}

/* 边和连接线 */
[data-theme='dark'] .react-flow__edge-path {
  stroke: #595959;
  stroke-width: 2;
}

[data-theme='dark'] .react-flow__edge-text {
  fill: #ffffff;
}

[data-theme='dark'] .react-flow__edge.selected .react-flow__edge-path {
  stroke: #1890ff;
}

/* 连接线手柄 */
[data-theme='dark'] .react-flow__handle {
  background-color: #595959;
  border-color: #404040;
}

[data-theme='dark'] .react-flow__handle:hover {
  background-color: #1890ff;
}

/* 控件 */
[data-theme='dark'] .react-flow__controls {
  background-color: #141414;
  border-color: #404040;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.5);
}

[data-theme='dark'] .react-flow__controls-button {
  background-color: #1a1a1a;
  border-color: #404040;
  color: #ffffff;
}

[data-theme='dark'] .react-flow__controls-button:hover {
  background-color: #2a2a2a;
}

[data-theme='dark'] .react-flow__controls-button svg {
  fill: #ffffff;
}

/* 小地图 */
[data-theme='dark'] .react-flow__minimap {
  background-color: #141414;
  border-color: #404040;
}

[data-theme='dark'] .react-flow__minimap-mask {
  fill: rgba(26, 26, 26, 0.8);
}

[data-theme='dark'] .react-flow__minimap-node {
  fill: #404040;
  stroke: #595959;
}

/* 选择框 */
[data-theme='dark'] .react-flow__selection {
  background-color: rgba(24, 144, 255, 0.1);
  border-color: #1890ff;
}

/* 节点选中状态 */
[data-theme='dark'] .react-flow__node.selected {
  box-shadow: 0 0 0 2px #1890ff;
}

/* 内联文本编辑器 */
[data-theme='dark'] .inline-text-editor {
  background-color: #141414;
  color: #ffffff;
  border-color: #1890ff;
}

[data-theme='dark'] .inline-text-editor:focus {
  border-color: #40a9ff;
  box-shadow: 0 0 0 2px rgba(24, 144, 255, 0.2);
}

/* 文本格式化工具栏 */
[data-theme='dark'] .text-format-toolbar {
  background-color: #1a1a1a;
  border-color: #404040;
}

[data-theme='dark'] .text-format-toolbar button {
  color: #ffffff;
  background-color: #2a2a2a;
  border-color: #404040;
}

[data-theme='dark'] .text-format-toolbar button:hover {
  background-color: #3a3a3a;
  border-color: #595959;
}

/* 节点上下文菜单 */
[data-theme='dark'] .node-context-menu {
  background-color: #1a1a1a;
  border-color: #404040;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
}

[data-theme='dark'] .node-context-menu-item {
  color: #ffffff;
}

[data-theme='dark'] .node-context-menu-item:hover {
  background-color: #2a2a2a;
}

/* 节点编辑面板 */
[data-theme='dark'] .node-edit-panel {
  background-color: #0a0a0a;
  color: #ffffff;
}

[data-theme='dark'] .node-edit-panel .ant-drawer-header {
  background-color: #141414;
  border-bottom-color: #404040;
}

[data-theme='dark'] .node-edit-panel .ant-drawer-body {
  background-color: #0a0a0a;
}

/* 节点库 - 背景由内联样式控制，这里只处理卡片和文字 */
[data-theme='dark'] .node-library .ant-card {
  background-color: #141414 !important;
  border-color: #505050 !important;
  color: #ffffff !important;
}

[data-theme='dark'] .node-library .ant-card:hover {
  border-color: #1890ff !important;
  background-color: #1a1a1a !important;
  box-shadow: 0 2px 8px rgba(24, 144, 255, 0.3);
  transform: translateY(-1px);
  transition: all 0.2s ease;
}

/* 节点库标题和文字 - 增强对比度 */
[data-theme='dark'] .node-library .ant-typography {
  color: #ffffff !important;
}

[data-theme='dark'] .node-library .ant-typography-secondary {
  color: #bfbfbf !important;
}

[data-theme='dark'] .node-library .ant-card .ant-space-item {
  color: #ffffff !important;
}

/* 流程图工具栏 - 背景由内联样式控制，这里只处理按钮和文字 */
[data-theme='dark'] .flowchart-toolbar {
  /* 移除背景色规则，避免与内联样式冲突 */
  border-bottom-color: #404040;
}

[data-theme='dark'] .flowchart-toolbar .ant-btn {
  color: #ffffff;
  border-color: #505050;
  background-color: #1a1a1a;
}

[data-theme='dark'] .flowchart-toolbar .ant-btn:hover {
  color: #40a9ff;
  border-color: #40a9ff;
  background-color: #2a2a2a;
}

[data-theme='dark'] .flowchart-toolbar .ant-btn-primary {
  background-color: #1890ff;
  border-color: #1890ff;
}

[data-theme='dark'] .flowchart-toolbar .ant-btn-primary:hover {
  background-color: #40a9ff;
  border-color: #40a9ff;
}

/* 工具栏标题 - 增强对比度 */
[data-theme='dark'] .flowchart-toolbar .ant-typography {
  color: #ffffff !important;
}

/* 工具栏输入框 */
[data-theme='dark'] .flowchart-toolbar .ant-input {
  background-color: #1a1a1a !important;
  border-color: #404040 !important;
  color: #ffffff !important;
}

[data-theme='dark'] .flowchart-toolbar .ant-input::placeholder {
  color: #737373 !important;
}

[data-theme='dark'] .flowchart-toolbar .ant-input:focus {
  border-color: #1890ff !important;
  box-shadow: 0 0 0 2px rgba(24, 144, 255, 0.2) !important;
}

/* 工具栏选择框 */
[data-theme='dark'] .flowchart-toolbar .ant-select-selector {
  background-color: #1a1a1a !important;
  border-color: #404040 !important;
  color: #ffffff !important;
}

[data-theme='dark'] .flowchart-toolbar .ant-select-arrow {
  color: #a6a6a6 !important;
}

[data-theme='dark'] .flowchart-toolbar .ant-select-selection-item {
  color: #ffffff !important;
}

/* 待办节点状态样式（暗黑模式） */
[data-theme='dark'] .react-flow__node-todo[data-status='completed'] {
  background-color: #162312;
  border-color: #49aa19;
  color: #95de64;
}

[data-theme='dark'] .react-flow__node-todo[data-status='in_progress'] {
  background-color: #2b2111;
  border-color: #d48806;
  color: #ffc53d;
}

[data-theme='dark'] .react-flow__node-todo[data-status='pending'] {
  background-color: #1a1a1a;
  border-color: #595959;
  color: #e8e8e8;
}

[data-theme='dark'] .react-flow__node-todo[data-status='paused'] {
  background-color: #141414;
  border-color: #434343;
  color: #8c8c8c;
}


/* 连接点基础样式优化 */
.react-flow__handle {
  width: 12px !important;
  height: 12px !important;
  background: #555 !important;
  border: 2px solid #fff !important;
  z-index: 10 !important;
  opacity: 0;
  transition: all 0.2s ease-in-out;
  pointer-events: all !important;
}

/* 节点 hover、选中或正在连接时显示 Handle */
.react-flow__node:hover .react-flow__handle,
.react-flow__node.selected .react-flow__handle,
.react-flow.connecting .react-flow__handle {
  opacity: 1;
}

/* 连接点 hover 效果增强 */
.react-flow__handle:hover {
  width: 16px !important;
  height: 16px !important;
  background: #1890ff !important;
  transform: scale(1.2);
}

/* 连接中状态 */
.react-flow__handle.connecting {
  background: #52c41a !important;
  opacity: 1;
}

/* 可连接状态 */
.react-flow__handle.connectable {
  background: #52c41a !important;
  opacity: 1;
}

/* 不可连接状态 */
.react-flow__handle.not-connectable {
  background: #ff4d4f !important;
  cursor: not-allowed;
  opacity: 0.5;
}

/* 暗黑模式下的连接点优化 */
[data-theme='dark'] .react-flow__handle {
  background: #595959 !important;
  border: 2px solid #404040 !important;
  opacity: 0;
}

[data-theme='dark'] .react-flow__node:hover .react-flow__handle,
[data-theme='dark'] .react-flow__node.selected .react-flow__handle,
[data-theme='dark'] .react-flow.connecting .react-flow__handle {
  opacity: 1;
}

[data-theme='dark'] .react-flow__handle:hover {
  background: #1890ff !important;
  border-color: #40a9ff !important;
}

[data-theme='dark'] .react-flow__handle.connecting,
[data-theme='dark'] .react-flow__handle.connectable {
  background: #52c41a !important;
  border-color: #73d13d !important;
}
