# 富文本编辑器使用指南

## 功能概述

已将"内容描述"和"图片"字段合并为一个富文本编辑器，支持：
- ✅ 直接粘贴富文本内容（保留格式）
- ✅ 粘贴图片
- ✅ 文本格式化（粗体、斜体、下划线、删除线）
- ✅ 标题层级（H1、H2、H3）
- ✅ 文字颜色和背景色
- ✅ 有序列表和无序列表
- ✅ 缩进调整
- ✅ 插入链接
- ✅ 插入本地图片

## 安装步骤

### 1. 安装依赖
```bash
cd "D:\多功能待办\MultiTodoApp"
install_rich_editor.bat
```

或手动安装：
```bash
npm install react-quill quill
npm install --save-dev @types/react-quill
```

### 2. 重新编译
```bash
npm run build:renderer
```

### 3. 启动应用
```bash
python start_app.py
```

## 使用方法

### 基本操作

1. **创建/编辑待办事项**
   - 点击"新建待办事项"按钮
   - 在"内容描述"区域看到富文本编辑器

2. **格式化文本**
   - 选中文本后，使用工具栏按钮进行格式化
   - 支持：粗体、斜体、下划线、删除线等

3. **插入图片**
   - 方式1：点击工具栏的图片按钮，选择本地图片
   - 方式2：直接从剪贴板粘贴图片（Ctrl+V）
   - 方式3：从网页拖拽图片到编辑器

4. **一键复制粘贴**
   - 从网页、Word、记事本等复制内容
   - 直接在编辑器中粘贴（Ctrl+V）
   - 自动保留格式和图片

### 工具栏功能

| 按钮 | 功能 | 快捷键 |
|------|------|--------|
| H1/H2/H3 | 标题层级 | - |
| **B** | 粗体 | Ctrl+B |
| *I* | 斜体 | Ctrl+I |
| U | 下划线 | Ctrl+U |
| S | 删除线 | - |
| 🎨 | 文字颜色 | - |
| 🖍️ | 背景色 | - |
| 1. | 有序列表 | - |
| • | 无序列表 | - |
| ⇦/⇨ | 缩进 | Tab/Shift+Tab |
| 🔗 | 插入链接 | - |
| 🖼️ | 插入图片 | - |
| 🧹 | 清除格式 | - |

### 高级技巧

1. **批量复制内容**
   ```
   1. 在源文档中选择内容（包括图片）
   2. Ctrl+C 复制
   3. 在编辑器中 Ctrl+V 粘贴
   4. 自动保留所有格式和图片
   ```

2. **图片处理**
   - 粘贴的图片会自动保存到本地
   - 使用 `file://` 协议引用本地图片
   - 支持常见图片格式（jpg、png、gif等）

3. **链接插入**
   - 选中文字
   - 点击链接按钮
   - 输入URL
   - 点击确定

## 数据存储

### 存储格式
- 富文本内容以HTML格式存储在数据库的 `content` 字段
- 图片嵌入在HTML中，使用本地文件路径
- 向后兼容：旧的纯文本内容仍可正常显示

### 数据迁移
- 旧数据：纯文本格式，自动显示
- 新数据：HTML格式，支持富文本和图片
- 无需手动迁移，自动兼容

## 注意事项

### 性能优化
- 建议单个待办事项的图片数量不超过10张
- 大图片会自动压缩显示
- 富文本内容建议不超过50KB

### 兼容性
- ✅ 支持Chrome内核（Electron）
- ✅ 支持所有现代浏览器
- ✅ 向后兼容旧数据

### 已知限制
- 图片使用本地路径，不支持在线图片URL
- 复制的在线图片会自动下载到本地
- 不支持视频和音频嵌入

## 故障排除

### 问题1：富文本编辑器不显示
**解决方案：**
```bash
# 重新安装依赖
npm install react-quill quill --force
# 重新编译
npm run build:renderer
```

### 问题2：图片无法显示
**解决方案：**
- 检查图片路径是否正确
- 确保图片文件存在
- 尝试重新上传图片

### 问题3：粘贴图片失败
**解决方案：**
- 确保有图片上传权限
- 检查磁盘空间
- 尝试使用工具栏的图片按钮上传

### 问题4：格式丢失
**解决方案：**
- 使用Ctrl+V粘贴而不是右键粘贴
- 确保源内容支持富文本格式
- 尝试使用"清除格式"后重新格式化

## 更新日志

### v1.0.0 (2025-01-14)
- ✅ 集成react-quill富文本编辑器
- ✅ 支持文本格式化
- ✅ 支持图片粘贴和上传
- ✅ 支持一键复制粘贴
- ✅ 移除独立的图片上传字段
- ✅ 向后兼容旧数据

## 技术细节

### 使用的库
- **react-quill**: 富文本编辑器组件
- **quill**: 底层编辑器引擎
- **@types/react-quill**: TypeScript类型定义

### 配置
```typescript
modules: {
  toolbar: [
    [{ 'header': [1, 2, 3, false] }],
    ['bold', 'italic', 'underline', 'strike'],
    [{ 'color': [] }, { 'background': [] }],
    [{ 'list': 'ordered'}, { 'list': 'bullet' }],
    [{ 'indent': '-1'}, { 'indent': '+1' }],
    ['link', 'image'],
    ['clean']
  ]
}
```

### 自定义样式
编辑器样式可在 `RichTextEditor.tsx` 中修改：
```typescript
style={{ height: '300px', marginBottom: '50px' }}
```

## 反馈与支持

如有问题或建议，请：
1. 查看本文档的故障排除部分
2. 检查控制台错误信息
3. 提供详细的错误描述和复现步骤

